[{"id":"58074716.d8cfa8","type":"tab","label":"GPIO","disabled":false,"info":""},{"id":"63cc00e.c082c","type":"tab","label":"DHT11","disabled":false,"info":""},{"id":"cc7f2fc4.6143b","type":"tab","label":"API","disabled":false,"info":""},{"id":"a73b3f47.8b964","type":"tab","label":"Zabbix","disabled":false,"info":""},{"id":"9c9d7e7f.83cae","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED ダッシュボード","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"YYYY/MM/DD","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"a06dd331.c6ddd","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED ダッシュボード","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"YYYY/MM/DD","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"21a1203c.6549a","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED ダッシュボード","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"YYYY/MM/DD","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"f2cd6312.093cd","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED ダッシュボード","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"YYYY/MM/DD","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"2d471390.00651c","type":"debug","z":"58074716.d8cfa8","name":"","active":false,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","x":610,"y":120,"wires":[]},{"id":"9986225a.25574","type":"link in","z":"58074716.d8cfa8","name":"","links":["bef6d6b4.f48438"],"x":255,"y":180,"wires":[["2d471390.00651c","1e25e7a2.541a68","ae4dda9e.6e20e8"]]},{"id":"1e25e7a2.541a68","type":"change","z":"58074716.d8cfa8","name":"","rules":[{"t":"set","p":"led","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":180,"wires":[[]]},{"id":"ae4dda9e.6e20e8","type":"rpi-gpio out","z":"58074716.d8cfa8","name":"","pin":"38","set":"","level":"0","freq":"","out":"out","x":600,"y":240,"wires":[]},{"id":"eddddf44.464a5","type":"comment","z":"58074716.d8cfa8","name":"LED","info":"","x":70,"y":60,"wires":[]},{"id":"15ab1a5a.a2fb86","type":"comment","z":"58074716.d8cfa8","name":"from API","info":"","x":140,"y":180,"wires":[]},{"id":"e4462789.85ac28","type":"http in","z":"cc7f2fc4.6143b","name":"","url":"/api/led","method":"get","upload":false,"swaggerDoc":"","x":170,"y":380,"wires":[["8486fff9.6b78"]]},{"id":"6b06242b.b0adec","type":"http response","z":"cc7f2fc4.6143b","name":"","statusCode":"","headers":{},"x":750,"y":380,"wires":[]},{"id":"8486fff9.6b78","type":"template","z":"cc7f2fc4.6143b","name":"","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"value\": {{global.led}}\n}","output":"json","x":460,"y":380,"wires":[["6b06242b.b0adec"]]},{"id":"ccafae88.e3bb9","type":"http in","z":"cc7f2fc4.6143b","name":"","url":"/api/led/on","method":"post","upload":false,"swaggerDoc":"","x":160,"y":520,"wires":[["d57d1926.2e7208"]]},{"id":"d57d1926.2e7208","type":"change","z":"cc7f2fc4.6143b","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":520,"wires":[["bef6d6b4.f48438","4693e1c6.6bfa5"]]},{"id":"6e669ec6.149cc","type":"http in","z":"cc7f2fc4.6143b","name":"","url":"/api/led/off","method":"post","upload":false,"swaggerDoc":"","x":160,"y":580,"wires":[["930da7fa.3ca628"]]},{"id":"930da7fa.3ca628","type":"change","z":"cc7f2fc4.6143b","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":580,"wires":[["bef6d6b4.f48438","4693e1c6.6bfa5"]]},{"id":"bef6d6b4.f48438","type":"link out","z":"cc7f2fc4.6143b","name":"","links":["9986225a.25574"],"x":535,"y":520,"wires":[]},{"id":"4693e1c6.6bfa5","type":"template","z":"cc7f2fc4.6143b","name":"","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"value\": {{ payload }}\n}","output":"json","x":580,"y":580,"wires":[["c923d67f.4f62c8"]]},{"id":"c923d67f.4f62c8","type":"http response","z":"cc7f2fc4.6143b","name":"","statusCode":"","headers":{},"x":750,"y":580,"wires":[]},{"id":"40e3f17b.03228","type":"inject","z":"a73b3f47.8b964","name":"","topic":"","payload":"raspberrypi-test","payloadType":"str","repeat":"5","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":160,"wires":[["c8f68e57.028ea"]]},{"id":"c8f68e57.028ea","type":"template","z":"a73b3f47.8b964","name":"","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"request\": \"sender data\",\n    \"data\": [\n        {\n            \"host\": \"{{payload}}\",\n            \"key\": \"temperature\",\n            \"value\": \"{{global.temperature}}\"\n        },\n        {\n            \"host\": \"{{payload}}\",\n            \"key\": \"humidity\",\n            \"value\": \"{{global.humidity}}\"\n        }\n    ]\n}","output":"str","x":360,"y":160,"wires":[["cd78d245.9dbac","704ffb82.b79514"]]},{"id":"8bde8f9.cc5457","type":"rpi-dht22","z":"63cc00e.c082c","name":"","topic":"rpi-dht11","dht":"11","pintype":"0","pin":"18","x":300,"y":160,"wires":[["85f40311.16242"]]},{"id":"aebb3319.2bb0b","type":"debug","z":"63cc00e.c082c","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","x":790,"y":100,"wires":[]},{"id":"6c0d4779.037db8","type":"inject","z":"63cc00e.c082c","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":160,"wires":[["8bde8f9.cc5457"]]},{"id":"d87d1938.7fcf28","type":"change","z":"63cc00e.c082c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(msg.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":160,"wires":[["aebb3319.2bb0b","951b2090.adea4"]]},{"id":"86426530.aa5318","type":"change","z":"63cc00e.c082c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(msg.humidity)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":320,"wires":[["8e9c0fcc.32aa","da13a3a2.63c56"]]},{"id":"8e9c0fcc.32aa","type":"debug","z":"63cc00e.c082c","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","x":790,"y":260,"wires":[]},{"id":"da13a3a2.63c56","type":"change","z":"63cc00e.c082c","name":"","rules":[{"t":"set","p":"humidity","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":320,"wires":[[]]},{"id":"951b2090.adea4","type":"change","z":"63cc00e.c082c","name":"","rules":[{"t":"set","p":"temperature","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":160,"wires":[[]]},{"id":"ec0e1663.bc6e28","type":"http in","z":"cc7f2fc4.6143b","name":"","url":"/api/humidity","method":"get","upload":false,"swaggerDoc":"","x":150,"y":320,"wires":[["a2dcb569.ea4868"]]},{"id":"3f815a54.af62b6","type":"http response","z":"cc7f2fc4.6143b","name":"","statusCode":"","headers":{},"x":750,"y":320,"wires":[]},{"id":"a2dcb569.ea4868","type":"template","z":"cc7f2fc4.6143b","name":"","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"value\": {{global.humidity}}\n}","output":"json","x":460,"y":320,"wires":[["3f815a54.af62b6"]]},{"id":"25c98789.1858b8","type":"http in","z":"cc7f2fc4.6143b","name":"","url":"/api/temperature","method":"get","upload":false,"swaggerDoc":"","x":140,"y":260,"wires":[["55c87aef.c0e354"]]},{"id":"266e2d50.daad72","type":"http response","z":"cc7f2fc4.6143b","name":"","statusCode":"","headers":{},"x":750,"y":260,"wires":[]},{"id":"55c87aef.c0e354","type":"template","z":"cc7f2fc4.6143b","name":"","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"value\": {{global.temperature}}\n}","output":"json","x":460,"y":260,"wires":[["266e2d50.daad72"]]},{"id":"cd78d245.9dbac","type":"function","z":"a73b3f47.8b964","name":"build request","func":"var length = msg.payload.length;\nvar buf = Buffer.alloc(4 + 1 + 8 + length);\n\n// Write Header\nbuf.write(\"ZBXD\", 0);\nbuf.writeInt8(0x01, 4);\nbuf.writeInt32LE(length, 5);\n\n// Write Data\nbuf.write(msg.payload, 13);\n\nmsg.payload = buf;\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":260,"wires":[["827eef2b.19893"]]},{"id":"827eef2b.19893","type":"tcp request","z":"a73b3f47.8b964","server":"zabbix.iw.ishikari-dc.jp","port":"10051","out":"time","splitc":"1000","name":"","x":320,"y":320,"wires":[["bf439e94.b3179"]]},{"id":"8dbaebd.643a418","type":"debug","z":"a73b3f47.8b964","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":610,"y":380,"wires":[]},{"id":"bf439e94.b3179","type":"function","z":"a73b3f47.8b964","name":"prase response","func":"response = JSON.parse(msg.payload.slice(13).toString());\nmsg.response = response.response;\nmsg.payload = response.info;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":380,"wires":[["8dbaebd.643a418"]]},{"id":"704ffb82.b79514","type":"debug","z":"a73b3f47.8b964","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":630,"y":160,"wires":[]},{"id":"900523cc.508f3","type":"comment","z":"a73b3f47.8b964","name":"Zabbix","info":"","x":70,"y":60,"wires":[]},{"id":"7647e75c.e31ef8","type":"comment","z":"cc7f2fc4.6143b","name":"フロントエンド","info":"","x":100,"y":60,"wires":[]},{"id":"a4ab3e85.7fb71","type":"comment","z":"cc7f2fc4.6143b","name":"POSTリクエスト","info":"","x":100,"y":460,"wires":[]},{"id":"ddcd9dd9.6c25f","type":"comment","z":"cc7f2fc4.6143b","name":"to GPIO","info":"","x":630,"y":520,"wires":[]},{"id":"b59bd6f2.ea1d68","type":"http in","z":"cc7f2fc4.6143b","name":"","url":"/top/","method":"get","upload":false,"swaggerDoc":"","x":180,"y":120,"wires":[["70cd45e.9a052bc"]]},{"id":"70cd45e.9a052bc","type":"template","z":"cc7f2fc4.6143b","name":"","field":"payload","fieldType":"msg","format":"html","syntax":"plain","template":"<html>\n    <head>\n        <script src=\"https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js\"></script>\n        <script type=\"application/javascript\">\n          function update(){\n            $.get(\"/api/temperature\").then(function(data){\n              $(\"#temperature\").text(data.value);\n            });\n            $.get(\"/api/humidity\").then(function(data){\n              $(\"#humidity\").text(data.value);\n            });\n          }\n          \n          function setLed(status){\n            if(status){\n              $.post(\"/api/led/on\");\n            }else{\n              $.post(\"/api/led/off\");\n            }\n          }\n        \n          $(function(){\n              setInterval(update, 5000);\n          });\n\n          $(function(){\n            $(\"#led_on\").click(function(){setLed(true)});\n            $(\"#led_off\").click(function(){setLed(false)});\n          });\n        </script>\n    </head>\n    <body>\n        \n        <h2>Sensors</h2>\n        <ul>\n            <li>Temperature: <span id=\"temperature\"></span></li>\n            <li>Humidity: <span id=\"humidity\"></span></li>\n        </ul>\n        \n        <h2>LED</h2>\n        <button id=\"led_on\">ON</button>\n        <button id=\"led_off\">OFF</button>\n        \n    </body>\n</html>","output":"str","x":460,"y":120,"wires":[["e2b9eafb.032568"]]},{"id":"e2b9eafb.032568","type":"http response","z":"cc7f2fc4.6143b","name":"","statusCode":"","headers":{},"x":750,"y":120,"wires":[]},{"id":"b85705c8.0a8288","type":"comment","z":"cc7f2fc4.6143b","name":"GETリクエスト","info":"","x":100,"y":200,"wires":[]},{"id":"5ed714f2.2658bc","type":"inject","z":"cc7f2fc4.6143b","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":190,"y":720,"wires":[["29b9d4f1.e60f6c"]]},{"id":"29b9d4f1.e60f6c","type":"change","z":"cc7f2fc4.6143b","name":"���期値代入","rules":[{"t":"set","p":"led","pt":"global","to":"payload","tot":"msg"},{"t":"set","p":"temperature","pt":"global","to":"payload","tot":"msg"},{"t":"set","p":"humidity","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":720,"wires":[[]]},{"id":"c6ded5f9.2e97a8","type":"comment","z":"cc7f2fc4.6143b","name":"グローバル変��初期化","info":"","x":120,"y":660,"wires":[]},{"id":"c46247bf.0ca058","type":"comment","z":"63cc00e.c082c","name":"温湿度センサー","info":"","x":100,"y":60,"wires":[]},{"id":"41870aaf.ba4154","type":"comment","z":"a73b3f47.8b964","name":"ホスト名を設定","info":"","x":140,"y":120,"wires":[]},{"id":"85f40311.16242","type":"switch","z":"63cc00e.c082c","name":"","property":"isValid","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":false,"outputs":2,"x":270,"y":360,"wires":[["d87d1938.7fcf28","86426530.aa5318"],["169d51b4.16027e"]]},{"id":"169d51b4.16027e","type":"change","z":"63cc00e.c082c","name":"0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":460,"wires":[["da13a3a2.63c56","8e9c0fcc.32aa","951b2090.adea4","aebb3319.2bb0b"]]}]